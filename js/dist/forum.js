(()=>{var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};(()=>{"use strict";const t=flarum.core.compat["forum/app"];var n=e.n(t);const o=flarum.core.compat["common/extend"],i=flarum.core.compat["common/components/TextEditor"];var r=e.n(i);const a=flarum.core.compat["common/components/TextEditorButton"];var c=e.n(a);const s=flarum.core.compat["common/utils/styleSelectedText"];var l=e.n(s);function u(e,t){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},u(e,t)}function f(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,u(e,t)}const p=flarum.core.compat["common/Component"];var d=e.n(p),b=["#FF4D4D","#FF8A3D","#FFD53D","#22C55E","#06B6D4","#3B82F6","#4F46E5","#A855F7","#EB8A90","#DED9E2","#536873","#FEFEE3","#2F3437","#6B3F2B","#121212","#7F1D1D"],v=function(e){function t(){return e.apply(this,arguments)||this}f(t,e);var n=t.prototype;return n.oninit=function(){var e=this;this.open=!1,this.anchor=null,this._onDocClick=function(t){var n;if(e.open){var o=e.popoverEl;o&&(o.contains(t.target)||null!=(n=e.anchor)&&n.contains(t.target)||e.close())}},this._onKey=function(t){"Escape"===t.key&&e.close()}},n.onremove=function(){document.removeEventListener("mousedown",this._onDocClick),document.removeEventListener("keydown",this._onKey)},n.toggle=function(){this.open=!this.open,this.open?(document.addEventListener("mousedown",this._onDocClick),document.addEventListener("keydown",this._onKey)):(document.removeEventListener("mousedown",this._onDocClick),document.removeEventListener("keydown",this._onKey))},n.close=function(){this.open&&(this.open=!1,document.removeEventListener("mousedown",this._onDocClick),document.removeEventListener("keydown",this._onKey),m.redraw())},n.view=function(e){var t=this,n=e.attrs,o=n.label,i=n.icon,r=void 0===i?"fas fa-palette":i,a=n.colors,c=void 0===a?b:a,s=n.onSelect,l=m("button.Button.Button--icon",{type:"button",title:o,"aria-haspopup":"dialog","aria-expanded":String(this.open),style:"background:transparent;box-shadow:none;transform:none;",onclick:function(e){e.preventDefault(),t.toggle(),e.currentTarget.blur()},oncreate:function(e){return t.anchor=e.dom}},m("i",{className:"icon "+r,"aria-hidden":"true"})),u=null;if(this.open&&this.anchor){var f=this.anchor.getBoundingClientRect();u={position:"fixed",left:f.left+f.width/2+"px",top:f.top+"px",transform:"translate(-50%, calc(-100% - 8px))"}}return m.fragment({key:"magicbb-color"},[l,this.open&&m("div.Magicbb-ColorPopover",{style:u,oncreate:function(e){return t.popoverEl=e.dom},onremove:function(){return t.popoverEl=null}},m("div.Magicbb-ColorGrid",(c||b).map(function(e){return m("button.Magicbb-Color",{type:"button",title:e,"aria-label":e,style:"background:"+e,onclick:function(n){n.preventDefault(),null==s||s(e),t.close()}})})))])},t}(d()),h=[{key:"info",icon:"fas fa-circle-info",font:"#1d4ed8",bg:"#eff6ff",border:"#60a5fa"},{key:"success",icon:"fas fa-check",font:"#047857",bg:"#ecfdf5",border:"#34d399"},{key:"warning",icon:"fas fa-triangle-exclamation",font:"#b45309",bg:"#fffbeb",border:"#fbbf24"},{key:"error",icon:"fas fa-xmark",font:"#b91c1c",bg:"#fef2f2",border:"#f87171"}],g=function(e){function t(){return e.apply(this,arguments)||this}f(t,e);var n=t.prototype;return n.oninit=function(){var e=this;this.open=!1,this.anchor=null,this._onDocClick=function(t){var n;if(e.open){var o=e.popoverEl;o&&(o.contains(t.target)||null!=(n=e.anchor)&&n.contains(t.target)||e.close())}},this._onKey=function(t){"Escape"===t.key&&e.close()}},n.onremove=function(){document.removeEventListener("mousedown",this._onDocClick),document.removeEventListener("keydown",this._onKey)},n.toggle=function(){this.open=!this.open;var e=document.addEventListener.bind(document),t=document.removeEventListener.bind(document);this.open?(e("mousedown",this._onDocClick),e("keydown",this._onKey)):(t("mousedown",this._onDocClick),t("keydown",this._onKey))},n.close=function(){this.open&&(this.open=!1,document.removeEventListener("mousedown",this._onDocClick),document.removeEventListener("keydown",this._onKey),m.redraw())},n.view=function(e){var t=this,n=e.attrs,o=n.label,i=n.icon,r=void 0===i?"fas fa-circle-exclamation":i,a=n.onSelect,c=m("button.Button.Button--icon",{type:"button",title:o,"aria-haspopup":"dialog","aria-expanded":String(this.open),style:"background:transparent;box-shadow:none;transform:none;",onclick:function(e){e.preventDefault(),t.toggle(),e.currentTarget.blur()},oncreate:function(e){return t.anchor=e.dom}},m("i",{className:"icon "+r,"aria-hidden":"true"})),s=null;if(this.open&&this.anchor){var l=this.anchor.getBoundingClientRect();s={position:"fixed",left:l.left+l.width/2+"px",top:l.top+"px",transform:"translate(-50%, calc(-100% - 8px))"}}return m.fragment({key:"magicbb-alert"},[c,this.open&&m("div.Magicbb-AlertPopover",{style:s,oncreate:function(e){return t.popoverEl=e.dom},onremove:function(){return t.popoverEl=null}},m("div.Magicbb-AlertGrid",h.map(function(e){return m("button.Magicbb-AlertChoice",{type:"button",title:e.key,"aria-label":e.key,style:"background:"+e.font,onclick:function(n){n.preventDefault(),null==a||a(e),t.close()}},m("i",{className:"icon "+e.icon,"aria-hidden":"true",style:"color:#fff"}))})))])},t}(d()),y=[{key:"left",icon:"fas fa-align-left",title:"Left"},{key:"center",icon:"fas fa-align-center",title:"Center"},{key:"right",icon:"fas fa-align-right",title:"Right"}],k=function(e){function t(){return e.apply(this,arguments)||this}f(t,e);var n=t.prototype;return n.oninit=function(){var e=this;this.isOpen=!1,this.anchor=null,this.popover=null,this._onDocClick=function(t){if(e.isOpen){var n=e.popover,o=e.anchor;n&&o&&(n.contains(t.target)||o.contains(t.target)||e.close())}},this._onKey=function(t){"Escape"===t.key&&e.close()}},n.onremove=function(){document.removeEventListener("mousedown",this._onDocClick),document.removeEventListener("keydown",this._onKey)},n.open=function(){this.isOpen||(this.isOpen=!0,document.addEventListener("mousedown",this._onDocClick),document.addEventListener("keydown",this._onKey))},n.close=function(){this.isOpen&&(this.isOpen=!1,document.removeEventListener("mousedown",this._onDocClick),document.removeEventListener("keydown",this._onKey),m.redraw())},n.toggle=function(){this.isOpen?this.close():this.open()},n.view=function(e){var t=this,n=e.attrs.label||"Image",o=e.attrs.onPick||function(){},i=m("button.Button.Button--icon",{type:"button",title:n,"aria-haspopup":"dialog","aria-expanded":String(this.isOpen),onclick:function(e){e.preventDefault(),t.toggle(),e.currentTarget.blur()},oncreate:function(e){t.anchor=e.dom},style:"background:transparent;box-shadow:none;transform:none;"},m("i",{className:"icon fas fa-images","aria-hidden":"true"})),r=null;if(this.isOpen&&this.anchor){var a=this.anchor.getBoundingClientRect();r={position:"fixed",left:a.left+a.width/2+"px",top:a.top+"px",transform:"translate(-50%, calc(-100% - 8px))"}}return[i,this.isOpen?m("div.Magicbb-ImagePopover",{style:r,oncreate:function(e){t.popover=e.dom},onremove:function(){t.popover=null}},m("div.Magicbb-ImageGrid",y.map(function(e){return m("button.Magicbb-ImageChoice",{type:"button",title:e.title,"aria-label":e.title,onclick:function(n){n.preventDefault(),o(e.key),t.close()}},m("i",{className:"icon "+e.icon,"aria-hidden":"true"}))}))):null]},t}(d());const w=flarum.core.compat["common/components/Button"];var E=e.n(w),x=function(e){function t(){for(var t,n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(t=e.call.apply(e,[this].concat(o))||this).open=!1,t.anchor=void 0,t.popEl=void 0,t.pos={top:-9999,left:-9999},t.visible=!1,t.raf1=null,t.raf2=null,t.onWin=function(){t.open&&(t.positionAbove(),m.redraw())},t.onKey=function(e){"Escape"===e.key&&t.close()},t.onDocDownCapture=function(e){if(t.open){var n=e.target,o=t.element,i=document.querySelector(".Magicbb-ColorPopover, .Magicbb-AlertPopover, .Magicbb-ImagePopover"),r=!!o&&o.contains(n),a=!!i&&i.contains(n);r||a||t.close()}},t.onDocClickCapture=function(e){if(t.open){var n=e.target,o=document.querySelector(".Magicbb-ColorPopover, .Magicbb-AlertPopover, .Magicbb-ImagePopover");o&&o.contains(n)&&requestAnimationFrame(function(){return t.close()})}},t}f(t,e);var n=t.prototype;return n.view=function(){var e=this,t=this.attrs.items;return m("span",{class:"Magicbb-MoreWrap",style:"display:inline-block"},m(E(),{className:"Button Button--icon Button--link",icon:"fas fa-wand-sparkles",onclick:function(t){null==t||null==t.preventDefault||t.preventDefault(),e.anchor=t.currentTarget,e.toggle()},title:this.attrs.label||"More","aria-expanded":this.open?"true":"false","aria-haspopup":"menu"}),this.open&&m("div",{class:"Magicbb-MorePopover",style:{top:this.pos.top+"px",left:this.pos.left+"px",visibility:this.visible?"visible":"hidden",willChange:"top, left"},oncreate:function(t){e.popEl=t.dom,e.raf1=requestAnimationFrame(function(){e.positionAbove(),e.raf2=requestAnimationFrame(function(){e.positionAbove(),e.visible=!0,m.redraw()})})},onremove:function(){return e.cleanup()},role:"menu"},m("div",{class:"Magicbb-MoreRow"},t.map(function(t){return"function"==typeof t.renderSub?m("span",{key:t.key,class:"Magicbb-MoreBtnIcon",title:t.title,role:"menuitem",tabindex:"0","aria-label":t.title,"aria-haspopup":"dialog","aria-expanded":"false"},t.renderSub()):m("button",{key:t.key,class:"Magicbb-MoreBtnIcon",role:"menuitem",title:t.title,"aria-label":t.title,type:"button",onclick:function(n){null==n||null==n.preventDefault||n.preventDefault();var o=t.onClick;e.close(),requestAnimationFrame(function(){return o(n)})}},t.icon?m("i",{class:t.icon,"aria-hidden":"true"}):m("i",{class:"fas fa-circle",style:"opacity:.35","aria-hidden":"true"}))}))))},n.toggle=function(){this.open?this.close():this.openPopover()},n.openPopover=function(){this.open=!0,this.visible=!1,this.pos={top:-9999,left:-9999},m.redraw(),window.addEventListener("resize",this.onWin,{passive:!0}),window.addEventListener("scroll",this.onWin,!0),document.addEventListener("mousedown",this.onDocDownCapture,!0),document.addEventListener("click",this.onDocClickCapture,!0),document.addEventListener("keydown",this.onKey)},n.close=function(){this.open=!1,this.visible=!1,m.redraw(),this.cleanup()},n.cleanup=function(){this.raf1&&cancelAnimationFrame(this.raf1),this.raf2&&cancelAnimationFrame(this.raf2),this.raf1=this.raf2=null,window.removeEventListener("resize",this.onWin),window.removeEventListener("scroll",this.onWin,!0),document.removeEventListener("mousedown",this.onDocDownCapture,!0),document.removeEventListener("click",this.onDocClickCapture,!0),document.removeEventListener("keydown",this.onKey)},n.positionAbove=function(){var e,t,n,o,i=null==(e=this.anchor)?void 0:e.getBoundingClientRect();if(i){var r=null==(t=this.popEl)?void 0:t.getBoundingClientRect(),a=null!=(n=null==r?void 0:r.width)?n:240,c=null!=(o=null==r?void 0:r.height)?o:44,s=document.documentElement.clientWidth||window.innerWidth,l=s<=768?220:0,u=Math.round(i.left),f=s-a-l-8;u>f&&(u=Math.max(8,f)),u<8&&(u=8);var p=Math.round(i.top-c-6);p<8&&(p=8),this.pos.left=u,this.pos.top=p}},t}(d());function C(e){var t=n().forum.attribute(e);return null==t||!!t}n().initializers.add("capybash-magicbb-buttons",function(){(0,o.extend)(r().prototype,"toolbarItems",function(e){var t=this,o=function(){return(null==(e=t)||null==(n=e.attrs)||null==(n=n.composer)||null==(n=n.editor)?void 0:n.el)||null;var e,n},i=function(){return(null==(e=t)||null==(n=e.attrs)||null==(n=n.composer)?void 0:n.editor)||null;var e,n},r=C("bb_toolbar_group"),a=[],s=function(e,t,n,r,s,u){void 0===u&&(u="");var f=function(e){null==e||null==e.preventDefault||e.preventDefault();var t=o(),n=i();t&&n&&(t.selectionStart===t.selectionEnd&&u?n.insertAtCursor((r.prefix||"")+u+(r.suffix||"")):l()(t,r))};a.push({key:e,prio:s,title:n,icon:t,vnode:m(c(),{icon:t,title:n,onclick:f}),asMenu:function(){return{key:e,title:n,icon:t,onClick:f}}})};if(C("bb_center")&&s("bb-center","fas fa-align-center",n().translator.trans("capybash-magicbb.forum.composer.center_button"),{prefix:"[center]",suffix:"[/center]",trimFirst:!0,multiline:!0},100),C("bb_justify")&&s("bb-justify","fas fa-align-justify",n().translator.trans("capybash-magicbb.forum.composer.justify_button"),{prefix:"[justify]",suffix:"[/justify]",trimFirst:!0,multiline:!0},99),C("bb_color")){var u=n().translator.trans("capybash-magicbb.forum.composer.color_button"),f=m(v,{label:u,colors:b,onSelect:function(e){var t=o(),n=i();if(t&&n){var r={prefix:"[color="+e+"]",suffix:"[/color]"};t.selectionStart!==t.selectionEnd?l()(t,r):n.insertAtCursor(r.prefix+"Heading"+r.suffix)}}});a.push({key:"bb-color",prio:98,title:u,icon:"fas fa-palette",vnode:f,asMenuSub:function(){return{key:"bb-color",title:u,icon:"fas fa-palette",renderSub:function(){return f}}}})}if(C("bb_spoiler")&&s("bb-spoiler","fas fa-layer-group",n().translator.trans("capybash-magicbb.forum.composer.spoiler_button"),{prefix:"[spoiler title=Heading]",suffix:"[/spoiler]"},97,"Subtitle"),C("bb_table")){var p=n().translator.trans("capybash-magicbb.forum.composer.table_button"),d=function(e){null==e||null==e.preventDefault||e.preventDefault();var t=i();null!=t&&t.insertAtCursor&&t.insertAtCursor("| Heading 1 | Heading 2 | Heading 3 |\n|---|---|---|\n| Cell 1 | Cell 2 | Cell 3 |\n| Cell 4 | Cell 5 | Cell 6 |")};a.push({key:"bb-table",prio:96,title:p,icon:"fas fa-table",vnode:m(c(),{icon:"fas fa-table",title:p,onclick:d}),asMenu:function(){return{key:"bb-table",title:p,icon:"fas fa-table",onClick:d}}})}if(C("bb_info")){var h=n().translator.trans("capybash-magicbb.forum.composer.info_button"),y=m(g,{label:h,onSelect:function(e){var t=o(),n=i();if(t&&n){var r=t.selectionStart!==t.selectionEnd,a=e.key,c="["+a+" title=Heading font="+e.font+" bg="+e.bg+" border="+e.border+"]",s="[/"+a+"]";r?l()(t,{prefix:c,suffix:s}):n.insertAtCursor(c+"Subtitle"+s)}}});a.push({key:"bb-info",prio:95.5,title:h,icon:"fas fa-info-circle",vnode:y,asMenuSub:function(){return{key:"bb-info",title:h,icon:"fas fa-info-circle",renderSub:function(){return y}}}})}if(C("bb_image")){var w=n().translator.trans("capybash-magicbb.forum.composer.image_button"),E=m(k,{label:w,onPick:function(e){var t,n=o(),r=i();if(n&&r){var a={prefix:"["+(t="left"===e?"ileft":"right"===e?"iright":"icenter")+"]",suffix:"[/"+t+"]"};if(n.selectionStart!==n.selectionEnd)l()(n,a);else{var c=function(e){var t=Math.max(0,e.selectionStart-800),n=Math.min(e.value.length,e.selectionEnd+800),o=e.value.slice(t,n).match(/\[upl-image-preview(?:(?!]).)*?\burl=(?:"[^"]+"|'[^']+'|[^\s\]]+)(?:(?!]).)*?]/i);if(!o)return null;var i=t+o.index;return{start:i,end:i+o[0].length,text:o[0]}}(n);if(c){var s=""+a.prefix+c.text+a.suffix;!function(e,t,n,o){e.setRangeText(o,t,n,"end"),e.dispatchEvent(new Event("input",{bubbles:!0}))}(n,c.start,c.end,s)}else r.insertAtCursor(a.prefix+"upl-image-preview uuid"+a.suffix)}}}});a.push({key:"bb-image",prio:95,title:w,icon:"fas fa-image",vnode:E,asMenuSub:function(){return{key:"bb-image",title:w,icon:"fas fa-image",renderSub:function(){return E}}}})}if(a.sort(function(e,t){return t.prio-e.prio}),r){var _=a.map(function(e){return"asMenuSub"in e?e.asMenuSub():e.asMenu()});e.add("bb-more",m(x,{items:_,label:n().translator.trans("capybash-magicbb.forum.composer.more_button")}),120)}else a.forEach(function(t){return e.add(t.key,t.vnode,t.prio)})})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map